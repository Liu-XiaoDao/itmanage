<% provide :c_active, "asset" %>

  <div class="container" style="padding-top:70px;">
    <div class="col-sm-12 col-md-12 center-block" style="float: none;">


    <div class="alert alert-info">
    	系统共有 <b><%= @devices.count %></b> 台设备<a href="<%= new_device_path %>" class="btn btn-primary" style="position: relative;top: -8px;float: right;">添加设备</a>
    </div>

      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
              <tr><th>ID</th><th>设备号</th><th>设备名称</th><th>设备服务号</th><th>管理部门</th><th>设备详情</th><th>设备所属</th><th>设备状态</th><th>到货时间</th><th>第一次使用时间</th><th>销毁时间</th><th>操作</th></tr>
          </thead>
          <tbody>

			<% @devices.each do |device| %>
			    <tr>
			      <td><%= device.id %></td>
			      <td><%= link_to device.asset_code, device_path(device) %></td>
			      <td><%= device.asset_name %></td>
			      <td><%= device.service_sn %></td>
			      <td><%= device.managed_by %></td>
			      <td><%= device.asset_details %></td>
			      <td><%= device.belong_to %></td>
			      <td><%= device_status device.status %></td>
			      <td><%= device.receive_date %></td>
			      <td><%= device.first_date %></td>
			      <td><%= device.scrap_date %></td>
			      <td><%= link_to '修改', edit_device_path(device) %></td>
			      <td><%= link_to '删除', device_path(device), method: :delete, data: { confirm: '你确定要删除吗?' } %></td>
			      <td><%= link_to '分配',"#", "data-toggle": "modal", "data-target": "#myModal", "did": "<%= device.id %>" %></td>
			    </tr>
			<% end %>
          </tbody>
        </table>
      </div>

    </div>
  </div>







<script>

    function show_position(ele) {
        $.ajax({
            type : "GET",
            url : "<%= ajaxgetuser_path %>",
            data : {
                'id':$(ele).val()
            },
            dataType : "JSON",
            success : function(result){
                if(!result.status){
                    var str = '<option value ="0">请选择</option>';
                    $.each(result,function (i,value) {
                      str += '<option value ="'+value.id+'">'+value.username+'</option>';
                    });
                    $('#ajaxdevice').html(str);
                }else{
                    if(result.msg){
                        alert(result.msg);
                    }
                }
            }
        });
    }

    function create_borrowtime(ele) {
        if ($(ele).val() == 4) {
            $("#borrowtime_div").css("display","block");
            $("#borrowtime_br").css("display","block");
        }else{
            $("#borrowtime_div").css("display","none");
            $("#borrowtime_br").css("display","none");
        }
    }
</script>



  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">设备分配</h4>
      </div>
        <%= form_tag  edit_device_path(1), id: "ajaxform" do %>
          <div class="modal-body" style="padding: 15px;">
              <div class="form-group">
                <label for="assigntype"> 分配类型:</label>
                <select class="form-control" name="device[assigntype]" id="assigntype" onchange="create_borrowtime(this)">
                  <option value="0">请选择设备分配类型</option>
                  <option value="1">办公使用</option>
                  <option value="4">借用</option>
                </select>
              </div>
              <br>
              <div class="form-group" id="borrowtime_div" style="display: none;">
                  <label for="borrowtime"> 借用时间:</label>
                  <input type="number" name="device[borrowtime]" class="form-control" id="borrowtime" placeholder="请输入借用时间,单位:天数">
              </div>
              <br id="borrowtime_br" style="display: none;">

              <div class="form-group">
                <label for="decategory"> 员工所在部门:</label>
                <select class="form-control" name="device[decategory]" id="decategory" onchange="show_position(this)">
                  <option value="">请选择设备部门</option>
                  <% @departments.each do |department| %>
                    <option value="<%= department.id %>"><%= department.department_name %></option>
                  <% end %>
                </select>
              </div>
              <br>
              <div class="form-group">
                <label for="department_id"> 员工:</label>
                <select id="ajaxdevice" class="form-control" name="device[department_id]" id="department_id">
                  <option value="">请选择设备</option>
                </select>
              </div>


          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            <button type="submit" class="btn btn-primary">提交更改</button>
          </div>
        <% end %>
    </div>
  </div>
</div>
